# FROM continuumio/miniconda

FROM jupyter/base-notebook
USER root
RUN apt-get update && apt-get install -yqq libzmq5 git \
      apt-transport-https ca-certificates curl software-properties-common \
      && curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \
      && add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" \
      && apt-get update \
      && apt-get install -yqq docker-ce

RUN gpasswd -a $NB_USER docker

USER $NB_USER

RUN conda create -n py2 python=2 jupyter
RUN /bin/bash -c "source activate py2 && ipython kernel install --user"

WORKDIR /home/$NB_USER

COPY setup/ setup/
COPY img/ img/
COPY tf_cifar_model/ tf_cifar_model/ 


ENV DATA cifar/

RUN mkdir -p $DATA \
      && /bin/bash -c "source activate py2 && conda install -y -q numpy pyzmq subprocess32 pandas matplotlib seaborn tensorflow \
      && pip install ray==0.2.0 tensorflow==1.3.0 gym==0.9.2 smart_open"

# TODO: update to pip install clipper==0.2.0 once the Clipper release is pushed
RUN git clone https://github.com/dcrankshaw/clipper.git --branch clipper_admin_v2 --single-branch \
      && /bin/bash -c "source activate py2 && pip install -e ./clipper/clipper_admin"


COPY rl_exercise06.ipynb pong_py/ ./

RUN /bin/bash -c "source activate py2 && pip install -e pong_py"

USER root
RUN chown jovyan:users -R /home/$NB_USER/
USER $NBUSER

# vim: set filetype=dockerfile:
